<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pergunta - {{ tema }} - Eureka do Padre</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pergunta.css') }}">
</head>
<body>
    <div class="pergunta-container">
        <!-- Cabe√ßalho com tema -->
        <div class="tema-header">
            <h1>{{ tema }}</h1>
        </div>

        <!-- Pergunta principal -->
        <div class="pergunta-box">
            <div class="pergunta-icone">?</div>
            <div class="pergunta-texto">{{ questao.enunciado }}</div>
        </div>

        <!-- Alternativas -->
        <div class="alternativas-grid">
            {% for alternativa in alternativas %}
            <div class="alternativa" data-opcao="{{ loop.index0 }}">
                <div class="alternativa-letra">{{ ['A', 'B', 'C', 'D'][loop.index0] }}</div>
                <div class="alternativa-texto">{{ alternativa }}</div>
            </div>
            {% endfor %}
        </div>

        <!-- Bot√µes de a√ß√£o -->
        <div class="acoes">
            <button id="btnRevelarResposta" class="btn-revelar">REVELAR RESPOSTA</button>
        </div>

        <!-- Se√ß√£o de equipes (inicialmente oculta) -->
        <div id="secaoEquipes" class="secao-equipes" style="display: none;">
            <div class="equipes-header">
                <h2>üéØ Quais equipes acertaram?</h2>
                <p class="equipes-subtitle">Clique nas equipes que deram a resposta correta</p>
            </div>
            <div class="equipes-grid">
                {% for equipe in equipes %}
                <div class="equipe-card" data-equipe-id="{{ equipe.id }}">
                    <div class="equipe-card-inner">
                        <div class="equipe-icon">üèÜ</div>
                        <div class="equipe-nome">{{ equipe.nome }}</div>
                        <div class="equipe-status">
                            <div class="status-icon">‚ùå</div>
                            <div class="status-text">N√£o selecionada</div>
                        </div>
                        <div class="equipe-points">+10 pontos</div>
                    </div>
                    <div class="equipe-glow"></div>
                    <input type="checkbox" id="equipe_{{ equipe.id }}" value="{{ equipe.id }}" style="display: none;">
                </div>
                {% endfor %}
            </div>
            <div class="acoes-finais">
                <button id="btnConfirmarVoltar" class="btn-confirmar-voltar">
                    <span class="btn-icon">‚úÖ</span>
                    <span class="btn-text">CONFIRMAR E VOLTAR √Ä ROLETA</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        const questaoId = parseInt('{{ questao.id }}');
        const respostaCorreta = parseInt('{{ questao.resposta_correta }}');

        document.getElementById('btnRevelarResposta').addEventListener('click', function() {
            // Destacar resposta correta
            const alternativas = document.querySelectorAll('.alternativa');
            alternativas.forEach(alt => {
                const opcao = parseInt(alt.getAttribute('data-opcao'));
                if (opcao === respostaCorreta) {
                    alt.classList.add('correta');
                } else {
                    alt.classList.add('incorreta');
                }
            });

            // Mostrar se√ß√£o de equipes
            document.getElementById('secaoEquipes').style.display = 'block';
            this.style.display = 'none';
            
            // Configurar interatividade dos cards das equipes
            setupEquipeCards();
        });

        function setupEquipeCards() {
            const equipeCards = document.querySelectorAll('.equipe-card');
            
            equipeCards.forEach(card => {
                card.addEventListener('click', function() {
                    const equipeId = this.getAttribute('data-equipe-id');
                    const checkbox = document.getElementById(`equipe_${equipeId}`);
                    const statusIcon = this.querySelector('.status-icon');
                    const statusText = this.querySelector('.status-text');
                    const isSelected = checkbox.checked;
                    
                    if (isSelected) {
                        // Desselecionar
                        checkbox.checked = false;
                        this.classList.remove('selected');
                        statusIcon.textContent = '‚ùå';
                        statusText.textContent = 'N√£o selecionada';
                        
                        // Anima√ß√£o de desele√ß√£o
                        this.style.transform = 'scale(0.95)';
                        setTimeout(() => {
                            this.style.transform = '';
                        }, 150);
                    } else {
                        // Selecionar
                        checkbox.checked = true;
                        this.classList.add('selected');
                        statusIcon.textContent = '‚úÖ';
                        statusText.textContent = 'Acertou!';
                        
                        // Anima√ß√£o de sele√ß√£o
                        this.style.transform = 'scale(1.05)';
                        setTimeout(() => {
                            this.style.transform = '';
                        }, 150);
                        
                        // Efeito de confete
                        createConfetti(this);
                    }
                });
            });
        }

        function createConfetti(element) {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7'];
            
            for (let i = 0; i < 15; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.cssText = `
                    position: absolute;
                    width: 8px;
                    height: 8px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    border-radius: 50%;
                    pointer-events: none;
                    z-index: 1000;
                `;
                
                const rect = element.getBoundingClientRect();
                confetti.style.left = (rect.left + rect.width / 2) + 'px';
                confetti.style.top = (rect.top + rect.height / 2) + 'px';
                
                document.body.appendChild(confetti);
                
                // Anima√ß√£o do confete
                const angle = (Math.PI * 2 * i) / 15;
                const distance = 50 + Math.random() * 50;
                const x = Math.cos(angle) * distance;
                const y = Math.sin(angle) * distance;
                
                confetti.animate([
                    { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                    { transform: `translate(${x}px, ${y}px) scale(0)`, opacity: 0 }
                ], {
                    duration: 800,
                    easing: 'ease-out'
                }).onfinish = () => confetti.remove();
            }
        }

        document.getElementById('btnConfirmarVoltar').addEventListener('click', function() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            const equipesAcertos = Array.from(checkboxes).map(cb => parseInt(cb.value));

            fetch('/processar_respostas', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    questao_id: questaoId,
                    equipes_acertos: equipesAcertos
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.sucesso) {
                    // Voltar diretamente √† roleta sem mensagem
                    window.location.href = '/roleta';
                } else {
                    alert('Erro ao registrar respostas: ' + (data.erro || 'Erro desconhecido'));
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao processar respostas: ' + error.message);
            });
        });
    </script>
</body>
</html>
